# PythNetworkSample

分散型オラクル PythNetwork を調査するためのプロトコルです。

## PythNetwork とは

Pyth Network は、マーケットデータの所有者と複数のブロックチェーン上のアプリケーションをつなぐオラクルプロトコルです。世界中の主要な取引所やマーケットメイキング企業を含む 100 以上の一部提供者からマーケットデータが提供されています。55 以上のブロックチェーン上で 350 以上のプロトコルが Pyth を信頼し、アプリケーションの安全性を確保しています。

## PythNetwork の仕組み

## Pyth プロトコルのデザイン概要

Pyth は、市場参加者が価格情報をオンチェーンで公開し、他者がそれを利用できるようにするプロトコルです。

Pyth プロトコルは、次の 3 つの主体間でのやり取りを通じて機能します。

1. **Publishers（データ提供者）**: Pyth のオラクルプログラムに価格情報を送信します。複数のデータ提供者が各プロダクトに価格情報を提供することで、システムの正確性と堅牢性を向上させます。
2. **Oracle Program（オラクルプログラム）**: 提供された価格データを集約し、1 つの価格と信頼区間を生成します。
3. **Consumers（データ利用者）**: オラクルプログラムが生成した価格情報を参照します。

Pyth のオラクルプログラムは「Pythnet」で動作し、そこで生成された価格データはクロスチェーンで他のブロックチェーンにも転送され、利用者がアクセスできるようになります。

### 重要な構成要素

システムの中心となるのは、各データ提供者の情報を集約するオラクルプログラムです。このプログラムは、Pyth 上の各プロダクトとその最新の価格データを管理するいくつかの SVM アカウントを保持しています。

- データ提供者は、各スロットごとにオラクルプログラムとやり取りし、自身の価格と信頼区間を公開します。
- 最初の価格更新時に、前のスロットで提供されたデータを集約し、1 つの価格と信頼区間にまとめます。

### Pythnet

Pythnet は、Pyth のデータプロバイダーによって運営されるブロックチェーンで、各価格フィードに対してデータプロバイダーの価格を安全に集約します。これは、Solana 技術を利用した Pyth 専用のブロックチェーンで、Solana のメインネットとは独立しています。Pythnet の目的は、価格集計を安全かつ信頼性高く実行することです。ネットワークのトランザクションログを検証することで、価格が正しく計算されたことを確認でき、Wormhole Guardians もこの検証を行います。

### Oracle Program

オラクルプログラムは、価格フィードの維持、データプロバイダーの価格を集約、信頼区間の計算、移動平均の計算などを行います。各価格フィードには製品アカウントと価格アカウントがあり、価格アカウントはデータプロバイダーの価格を更新・管理します。

### クロスチェーン

Pyth は、Pythnet から他のブロックチェーンに価格を転送するためにクロスチェーンメカニズムを使用します。Hermes は最新の価格更新データを収集し、HTTP や WebSocket API で提供します。

### 手数料

Pyth ネットワークプロトコルでは、オンチェーンで価格フィードを更新する際に手数料が発生します。これにより、データプロバイダーへの報酬などに使用されます。手数料はユーザーに転嫁され、Pyth の SDK はこの手数料処理をサポートしています。

### Hermes

Hermes は、Pythnet や Wormhole ネットワークからの価格更新を収集し、API で提供するウェブサービスです。Hermes API を使って、最新の価格更新を簡単に取得できます。

### 価格集計

Pyth は、データプロバイダーから送信された価格と信頼区間を集約し、単一の価格と信頼区間を提供します。集計アルゴリズムは、操作に対する耐性、データソースの精度を適切に反映、個々の価格の変動に基づく信頼区間の調整を目的としています。

### EMA 価格集計

Pyth ネットワークは、加重移動平均（EMA）価格と信頼区間も提供しています。これにより、時間を考慮した価格平均が利用可能です。

### Pyth Network の提供する製品

- **価格フィード**: 500 以上の資産のリアルタイム価格を 55 以上のブロックチェーン（Solana、EVM チェーン、Aptos、Sui、NEAR、Cosmos チェーンなど）で提供。
- **ベンチマーク**: 過去の Pyth 価格データをオンチェーンおよびオフチェーンで利用可能。
- **エクスプレスリレー**: プロトコルが MEV（最大抽出価値）を排除し、アクティブなサーチャーや清算者にアクセスできるようにする機能。
- **エントロピー**: ブロックチェーン上で安全な乱数を生成する機能を提供。

### その他の有用なリンク

- **Pyth トークン**: Pyth のガバナンストークン PYTH について詳しく知る。
- **Pyth メトリクス**: ネットワークの採用状況や成長に関する指標を確認。

## PythNetwork と Chainlink の違い

### 1. 目的の違い

- **Pyth**: DeFi プロトコルのために高精度で高頻度な金融市場データを提供します。データは暗号通貨、株式、金属など多岐にわたります。
- **Chainlink**: スマートコントラクトに現実のデータを提供し、金融データ以外にもゲームや天気など様々な分野で活用されます。

### 2. データ提供元

- **Pyth**: CBOE や Binance、Kucoin などの金融機関や暗号取引所から直接データが提供されます。
- **Chainlink**: 主に BraveNewCoin や CoinMarketCap などのサードパーティデータ集約サービスを利用しています。

### 3. 更新頻度と仕組み

- **Pyth**: 300 ～ 400ms ごとにリアルタイムでデータを更新し、ブロックチェーンごとの速度に応じて柔軟な更新が可能です。
- **Chainlink**: 特定の条件下でのみ価格が更新され、ブロックチェーンごとに更新頻度が異なります。例: Ethereum では 1 時間ごと、BNB Chain では 1 分ごとに更新されます。

### 4. データの透明性と所有権

- **Pyth**: データはブロックチェーン上で検証可能で、データ提供者が完全な所有権を持っています。
- **Chainlink**: データ提供者が直接の所有者ではなく、検証が難しい場合があります。

### 5. 特別な機能

- **Pyth**: 低遅延、信頼区間（CI）、リキダションサービスなどの機能があります。
- **Chainlink**: 証明可能な乱数生成や準備金証明などが提供されています。

### 6. ブラックスワンイベント対応

- **Pyth**: 2022 年 5 月の LUNA/UST 事件では、Pyth は LUNA 価格を正確に追跡しました。
- **Chainlink**: 同事件では、Chainlink の回路ブレーカー機能が価格更新を停止し、不正確な価格が提供されました。

### 7. 対応チェーンの数

PythNetwork は非 EVM 系をはじめ、対応数が圧倒的。

Chainlink も以前より増えているが限定的

## ホワイトペーパー要約

### 概要

Pyth Network は、従来は限られた機関やユーザーのみがアクセスできた金融市場データを、DeFi アプリケーションや一般に提供することを目的としたオラクルプロトコルです。取引企業や市場参加者にインセンティブを与え、彼らが日常業務で集めた価格データをオンチェーンで公開し、消費者が利用できるようにしています。初期の設計は Solana ブロックチェーンを中心にしたものでしたが、第 2 版ではクロスチェーンモデルに基づく価格デリバリーが導入されています。

### プロトコルの仕組み

Pyth プロトコルは、以下の 2 つの参加者を想定しています：

- **パブリッシャー**: 市場の価格データを提供し、報酬を得る。取引企業や市場参加者など、正確でタイムリーな価格情報を持つ人々。
- **コンシューマー**: データを読み取り、スマートコントラクトや dApp に組み込む。データにアクセスするために手数料を支払う。

価格データは複数のブロックチェーン上で利用可能であり、Pyth の価格データは特定のチェーンに向けてクロスチェーンで配信されます。Pythnet という専用のブロックチェーン上で価格データを管理し、Wormhole ネットワークなどの分散クロスチェーンメッセージングプロトコルを通じて配信されます。

### クロスチェーンアーキテクチャ

Pyth のクロスチェーンアーキテクチャは、以下の要件を満たすように設計されています：

1. **取引コストの最小化**: 複数のブロックチェーンで価格フィードを維持するためのコストを最小限に抑える。
2. **高頻度・低レイテンシーな価格更新**: 価格データのタイムリーな提供を可能にする。
3. **多くのブロックチェーンにスケールする能力**: 多様なブロックチェーン上で価格データを提供できるようにする。
4. **多くの価格フィードにスケールする能力**: 暗号資産や非暗号資産を含む多様な価格フィードに対応する。

### プル型 vs プッシュ型オラクル

従来のオラクルはプッシュ型が主流で、オラクルが定期的にデータをチェーンにプッシュし、そのたびにガス代が発生します。Pyth はプル型のアーキテクチャを採用しており、消費者がデータを必要とする際にのみガス代を支払うため、より効率的です。このモデルにより、Pyth は多くの価格フィードやブロックチェーンに対応し、頻繁な価格更新が可能になります。

### 価格更新の流れ

1. **価格データの集約**: Pythnet 上で複数のパブリッシャーから提供された価格データを集約し、平均価格を計算。
2. **価格のブロードキャスト**: Pythnet の検証者が集約された価格データをメッセージとして、Wormhole ネットワークなどを通じて他のチェーンにブロードキャスト。
3. **価格のリレイ**: 受信側のブロックチェーンでは、許可のないオペレーションで価格を更新。価格が更新されていない場合、消費者が価格更新を呼び出すことでデータが最新化される。

### 利用料金

価格データをチェーン上で更新する際、消費者はネイティブトークンで手数料を支払います。Pyth のプル型アーキテクチャにより、価格データが必要な場合にのみコストが発生します。

### Pyth の強み

- **効率的なガス使用**: データが必要なときだけガス代が発生し、無駄なコストを削減。
- **高頻度な価格更新**: Pythnet での高頻度なデータ更新により、時間加重平均（EMA）などの状態計算も正確に実行可能。

### 3. 価格の集約メカニズム

価格集約メカニズムは、各パブリッシャーが提供する価格と信頼区間を 1 つの集約価格と信頼区間に統合します。例えば、1 人のパブリッシャーが BTC/USD の価格を「$52000 ± 10」と報告し、別のパブリッシャーが「$53000 ± 20」と報告した場合、集約価格は「$52500 ± 500」となります。

価格集約アルゴリズムの特徴は次の通りです:

1. **操作耐性**: パブリッシャーが偶発的または意図的に価格を操作するのを防ぎます。
2. **データの精度を考慮**: 精度が異なるデータソースを適切に評価します。例えば、流動性の低い取引所は広いスプレッドを持つため、集約価格はより精度の高い取引所の価格に近くなります。
3. **信頼区間の反映**: 複数の取引所で価格が異なるため、集約信頼区間はこれらの違いや市場の限界を反映します。

アルゴリズムは「加重中央値」を使用し、各パブリッシャーにステークウェイトを設定し、そのウェイトに基づいて集約価格を計算します。また、信頼区間は集約価格からの偏差を基に決定されます。

### 4. ガバナンス

Pyth Network のオンチェーンガバナンスは、次のような役割を担います:

- 更新手数料の決定
- パブリッシャーへの報酬分配の決定
- 各ブロックチェーンにおけるオンチェーンプログラムのアップデート承認
- 新しい商品のリストや基準データの決定
- パブリッシャーのデータ提供権限の管理

### 5. トークン分配

PYTH トークンの総供給量は 100 億で、これ以上増えることはありません。トークンの 85%は初期段階でロックされており、6 ヶ月、18 ヶ月、30 ヶ月、42 ヶ月後に順次解除されます。残りの 15%は最初からアンロックされています。

#### トークン配分:

- パブリッシャー報酬: 22%
- エコシステム成長: 52%
- プロトコル開発: 10%
- コミュニティとローンチ: 6%
- プライベートセール: 10%

### 6. 結論

Pyth Network は、正確かつ高解像度の金融市場データをオンチェーンで提供するオラクルプロトコルを提案しています。このプロトコルは、データのパブリッシャーと消費者を結びつけ、持続可能な分散型ネットワークとして機能します。高品質な価格データを提供するパブリッシャーを集め、消費者からのデータ使用料でパブリッシャーに報酬を支払う仕組みを整備し、不正な操作を防ぐメカニズムを備えています。

### 参考文献

1. [分散型オラクルでの競争が激化：2024 年に Pyth が大きく成長、チェーンリンクの牙城を脅かす](https://jp.cointelegraph.com/news/chainlink-faces-rising-competition-pyth-grows-tvs)
2. [pyth-vs-chainlink](https://www.pyth.network/pyth-vs-chainlink)
3. [dune pythnetwork dashboard](https://dune.com/cctdaniel/pyth-push-oracle-on-solana)
4. [dune pythnetwork dashboard2](https://dune.com/cctdaniel/pyth-pull-oracle-on-solana)
5. [過去データ一覧](https://docs.pyth.network/home/metrics/kpi/june-24)
6. [Price Feed IDs](https://www.pyth.network/developers/price-feed-ids)
7. [Getting Started](https://docs.pyth.network/price-feeds/getting-started)
8. [チュートリアル](https://docs.pyth.network/price-feeds/create-your-first-pyth-app/evm/part-1)
